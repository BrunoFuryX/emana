<article class="product">
    <article style="display: none">
        {% set dateFinal = product.deactivation_date | split('-')  %}
        {% set dateModified = product.modified | split('-')  %}
        {% set year = dateFinal[0] <= 0 ? dateModified[0] + 50 : product.deactivation_date %}
        {% set month = dateFinal[1] <= 0 ? dateModified[1] + 01 : product.deactivation_date %}
        {% set day = dateFinal[2] <= 0 ? dateModified[2] + 01 : product.deactivation_date %}
        {% set dateDeactivation =  dateFinal[0] <= 0 ? year ~ "-" ~ month ~ "-" ~ day : product.deactivation_date %}

        <span itemprop="brand">{{ product.brand }}</span>
        <span itemprop="sku">{{ product.id }}</span>
        <span
            itemprop="description">{{ product.description ? product.description : product.description_small }}</span>
        <span itemprop="gtin8">{{ product.id }}</span>

        {% if product.ranking.rating >= 5 %}
        <div itemprop="aggregateRating" itemscope itemtype="http://schema.org/AggregateRating">
            <span itemprop="ratingValue">{{product.ranking.rating}}</span>
            <span itemprop="reviewCount">{{ product.ranking.count }}</span>
        </div>
        {% else %}
        <div itemprop="aggregateRating" itemscope itemtype="http://schema.org/AggregateRating">
            <span itemprop="ratingValue">4</span>
            <span itemprop="reviewCount">4</span>
        </div>
        {% endif %}
        <ul itemprop="review" itemscope itemtype="http://schema.org/Review">
            {% set author = comment.customer.name != "" ? comment.customer.name : "Anônimo" %}

            {% if author == "Anônimo" %}
            <span itemprop="author">{{ author }}</span>
            {% endif %}

            {% for comment in product.comments %}

            {% set author = comment.customer.name != "" ? comment.customer.name : "Anônimo" %}

            <span itemprop="name"> {{ comment.rating }} </span>
            <span itemprop="author">{{ author }}</span>
            <meta itemprop="datePublished" content="{{ comment.date }}">{{ comment.date }}
            <div itemprop="reviewRating" itemscope itemtype="http://schema.org/Rating">
                <meta itemprop="worstRating" content="1" />
                <span itemprop="ratingValue">{{ comment.rating }}</span>
                <span itemprop="bestRating">{{ comment.rating }}</span>
            </div>
            <span itemprop="description">{{ comment.comment }}</span>

            {% endfor %}
        </ul>


        <a href="{{ product.link }}">
            <img class="img-responsive lazy" data-original="{{ product.images[0].full }}"
                src="{{ asset('img/loading.gif') }}" alt="{{ product.name }}" itemprop="image" layout="responsive">
        </a>

        <div class="preco-por" itemprop="offers" itemscope itemtype="http://schema.org/Offer">
            <div style="display: none !important;">
                <span itemprop="priceValidUntil"> {{ dateDeactivation }}</span>
                <a itemprop="url" href="{{ product.link }}"> {{ product.link }} </a>

                {% if product.available and product.stock > 0 %}
                <link itemprop="availability" href="http://schema.org/InStock" />In stock
                {% else %}
                <meta itemprop="availability" content="http://schema.org/SoldOut">
                {% endif %}
            </div>
            <strong>
                <span itemprop="priceCurrency" content="BRL">R$ </span>
                <span itemprop="price" content="{{ product.price_offer }}">{{ product.price_offer|currency }}</span>
            </strong>
        </div>

    </article>

    <div class="product__header">
        <figure class="product__figure">
        {% if product.images %}
            <a class="product__link" href="{{ settings.buy_to_cart ? links.cart_add ~ product.id : product.link }}" data-tray-tst="vitrine_produto_link_imagem">
            
                <img class="product__image lazy-new" 
                src="{{ product.images[0].small }}" 
                data-src="{{ product.images[0].full }}" 
                data-srcset="{{ product.images[0].full }}" 
                alt="{{ product.name }}"
                title="{{ product.name }}"
                width="180"
                height="180"
                layout="responsive">

            </a>
        {% else %}
            <a class="product__link" href="{{ settings.buy_to_cart ? links.cart_add ~ product.id : product.link }}" data-tray-tst="vitrine_produto_link_imagem">
                <img class="product__image lazy-new" 
                src="{{ product.images[0].small }}" 
                data-src="{{ product.images[0].full }}" 
                data-srcset="{{ product.images[0].full }}" 
                alt="{{ product.name }}"
                title="{{ product.name }}"
                width="180"
                height="180"
                layout="responsive">
            </a>
        {% endif %}
        </figure>
        
        {% if settings.discount %}
            {% set porcentagemDesconto = 100 - ( product.price_offer / product.price ) * 100 %}
            {% if porcentagemDesconto < 100 %}
                <span class="discount"> {{ porcentagemDesconto|number_format }}% de desconto </span>
            {% endif %}  
        {% endif %}             
    </div>

    <div class="product__main">
        <h1 class="product__name"><a class="product__link" href="{{ settings.buy_to_cart ? links.cart_add ~ product.id : product.link }}" data-tray-tst="vitrine_produto_link_imagem">{{ product.name }}</a></h1>

        <div data-module="pricing" data-snippet="snippets/product-payment" data-product-id="{{ product.id }}">
            <div class="pricing">
                Carregando...
            </div>
        </div>
    </div>
    {% if product.stock > 0 %} 
    <div class="product__actions">
        <a class="product__link" href="{{ settings.buy_to_cart ? links.cart_add ~ product.id : product.link }}" >
            <svg xmlns="http://www.w3.org/2000/svg" width="18.622" height="18.102" viewBox="0 0 18.622 18.102">
                <g id="Camada_2" data-name="Camada 2" transform="translate(0 0.71)">
                  <g id="Layer_1" data-name="Layer 1" transform="translate(0 0)">
                    <path id="Caminho_3" data-name="Caminho 3" d="M.79.71h2.5L6.234,11.773l.726,2.716h10.15" transform="translate(-0.79 -0.71)" fill="none" stroke="#fff" stroke-miterlimit="10" stroke-width="1.42"/>
                    <path id="Caminho_4" data-name="Caminho 4" d="M3.4,3.03H17.9L16.453,11,5.515,10.9Z" transform="translate(-0.134 -0.127)" fill="none" stroke="#fff" stroke-miterlimit="10" stroke-width="1.42"/>
                    <circle id="Elipse_1" data-name="Elipse 1" cx="1.452" cy="1.452" r="1.452" transform="translate(5.444 13.779)" fill="none" stroke="#fff" stroke-miterlimit="10" stroke-width="1.42"/>
                    <circle id="Elipse_2" data-name="Elipse 2" cx="1.452" cy="1.452" r="1.452" transform="translate(14.868 13.779)" fill="none" stroke="#fff" stroke-miterlimit="10" stroke-width="1.42"/>
                  </g>
                </g>
            </svg>
            Comprar
        </a>
    </div>
    {% endif %}
    
</article>

