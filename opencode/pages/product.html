{% if banner.title %}
<div class="banner banner--product">
    {{ banner.title }}
</div>
{% endif %}

{% element 'snippets/breadcrumb' { "class": 'breadcrumb'} %}

<section class="page-product__essential" itemscope itemtype="http://schema.org/Product">
    <article style="display: none">
        {% set dateFinal = product.deactivation_date | split('-')  %}
        {% set dateModified = product.modified | split('-')  %}
        {% set year = dateFinal[0] <= 0 ? dateModified[0] + 50 : product.deactivation_date %}
        {% set month = dateFinal[1] <= 0 ? dateModified[1] + 01 : product.deactivation_date %}
        {% set day = dateFinal[2] <= 0 ? dateModified[2] + 01 : product.deactivation_date %}
        {% set dateDeactivation =  dateFinal[0] <= 0 ? year ~ "-" ~ month ~ "-" ~ day : product.deactivation_date %}

        <span itemprop="brand">{{ product.brand }}</span>
        <span itemprop="sku">{{ product.id }}</span>
        <span
            itemprop="description">{{ product.description ? product.description : product.description_small }}</span>
        <span itemprop="gtin8">{{ product.id }}</span>

        {% if product.ranking.rating >= 5 %}
        <div itemprop="aggregateRating" itemscope itemtype="http://schema.org/AggregateRating">
            <span itemprop="ratingValue">{{product.ranking.rating}}</span>
            <span itemprop="reviewCount">{{ product.ranking.count }}</span>
        </div>
        {% else %}
        <div itemprop="aggregateRating" itemscope itemtype="http://schema.org/AggregateRating">
            <span itemprop="ratingValue">4</span>
            <span itemprop="reviewCount">4</span>
        </div>
        {% endif %}
        <ul itemprop="review" itemscope itemtype="http://schema.org/Review">
            {% set author = comment.customer.name != "" ? comment.customer.name : "Anônimo" %}

            {% if author == "Anônimo" %}
            <span itemprop="author">{{ author }}</span>
            {% endif %}

            {% for comment in product.comments %}

            {% set author = comment.customer.name != "" ? comment.customer.name : "Anônimo" %}

            <span itemprop="name"> {{ comment.rating }} </span>
            <span itemprop="author">{{ author }}</span>
            <meta itemprop="datePublished" content="{{ comment.date }}">{{ comment.date }}
            <div itemprop="reviewRating" itemscope itemtype="http://schema.org/Rating">
                <meta itemprop="worstRating" content="1" />
                <span itemprop="ratingValue">{{ comment.rating }}</span>
                <span itemprop="bestRating">{{ comment.rating }}</span>
            </div>
            <span itemprop="description">{{ comment.comment }}</span>

            {% endfor %}
        </ul>


        <a href="{{ product.link }}">
            <img class="img-responsive lazy" data-original="{{ product.images[0].full }}"
                src="{{ asset('img/loading.gif') }}" alt="{{ product.name }}" itemprop="image" layout="responsive">
        </a>

        <div class="preco-por" itemprop="offers" itemscope itemtype="http://schema.org/Offer">
            <div style="display: none !important;">
                <span itemprop="priceValidUntil"> {{ dateDeactivation }}</span>
                <a itemprop="url" href="{{ product.link }}"> {{ product.link }} </a>

                {% if product.available and product.stock > 0 %}
                <link itemprop="availability" href="http://schema.org/InStock" />In stock
                {% else %}
                <meta itemprop="availability" content="http://schema.org/SoldOut">
                {% endif %}
            </div>
            <strong>
                <span itemprop="priceCurrency" content="BRL">R$ </span>
                <span itemprop="price" content="{{ product.price_offer }}">{{ product.price_offer|currency }}</span>
            </strong>
        </div>

    </article>


    <div class="page-product__header">
        <h1 class="page-product__name" itemprop="name">{{ product.name }}</h1>

        <div class="page-product__short-review">
            {% element 'snippets/rating-short' { 'product': product } %}
        </div>

        <div class="page-product__head">
            {% if product.brand %}
            <div class="page-product__brand">
                Marca: {{ product.brand }}
            </div>
            {% endif %}
            {% if product.model %}
            <div class="page-product__model">
                Modelo: {{ product.model }}
            </div>
            {% endif %}
        </div>

    </div>

    <div class="page-product__image">

        {% if product.images %}
        <div id="visualBlock"
            class="page-product__gallery {{ product.images|length  <= 1 and not product.video ? 'hide-carousel' }}">
            {{ productHelper.gallery() }}
        </div>
        {% else %}
        <div class="product-product__gallery page-product__gallery--no-image">
            <img src="{{ asset('img/no-image.svg') }}" alt="Nenhuma imagem foi cadastrada">
        </div>
        {% endif %}

        <div class="page-product__labels">
            {{ productHelper.labels() }}
        </div>

    </div>

    <div class="page-product__details">
        {% if productHelper.banner() %}{{ productHelper.banner() }}{% endif %}

        {{ productHelper.bonus() }}

        <form id="form_comprar" method="post" data-app="product.buy-form" action="{{ links.cart_add ~ product.id }}">

            {% if product.available != 0 %}
            {{ productHelper.variants() }}
            {% endif %}

            <div data-module="pricing" data-snippet="snippets/pricing" data-product-id="{{ product.id }}">
                <div class="pricing">
                    Carregando...
                </div>
            </div>

            {{ productHelper.gifts() }}
            {{ product.additional_information }}
            <div class="page-product__actions">
                {{ productHelper.form() }}
            </div>
            {{ productHelper.kit() }}

            {{ productHelper.shipping() }}

            {% if product.additional_message %}
            <div class="additional-message">
                {{ product.additional_message }}
            </div>
            {% endif %}
        </form>

        <ul class="page-product__links">
            <li class="page-product__links-item page-product__links-item--friend">
                <a class="page-product__links-link" data-url="{{ links.product_recommend }}&IdProd={{ product.id }}"
                    data-title="{{ product.name }}" data-toggle="modal" data-target="#modal-form"
                    data-modal-width="600px" href="#">{{ Translation('indique_amigo') }}</a>
            </li>

            <li class="page-product__links-item page-product__links-item--help">
                <a class="page-product__links-link" data-url="{{ links.product_question }}&IdProd={{ product.id }}"
                    data-title="{{ product.name }}" data-toggle="modal" data-target="#modal-form"
                    data-modal-width="600px" href="#">{{ Translation('tire_duvidas') }}</a>
            </li>

            <li class="page-product__links-item page-product__links-item--compare">
                <span class="page-product__links-link" id="product-compare">
                    {% if settings.compare %}
                    <span id="comparar">
                        {% element 'product/compare' {
                            'product': product,
                            'links': links
                        } %}
                    </span>
                    {% endif %}
                </span>
            </li>
            {% if not product.upon_request and product.available %}
            <li class="page-product__links-item page-product__links-item--wishlist">
                {{ productHelper.wishlist() }}
            </li>
            {% endif %}
        </ul>


    </div>
</section>

{% element 'snippets/product-tabs' { 'product': product, 'productTabs': productTabs } %}

{% element 'buy-together' %}


{% if product.related_products %}
<div id="prognoos_lsi"></div>
<section class="products-related">
    <h3 class="related-title">{{ Translation('produtos_relacionados') }}</h3>
    <div class="row">
        {% for related in product.related_products %}
        <div class="col-sm-3">
            {% element 'snippets/product' {"product": related} %}
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<div id="prognoos_ib"></div>


{% if banner.bottom %}
<div class="banner banner-bottom {% if not settings.enable_banner_default %}mobile-off{% endif %}">
    {{ banner.bottom }}
</div>
{% endif %}

<div id="loading-product-container"
    style="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.8) none repeat scroll 0% 0%; justify-content: center; align-items: center; display: none;">
    <img src="https://images.tcdn.com.br/580246/themes/45/img/loading2.gif?f4417d34cfceac1cba630f07849e656c1601645070"
        width="60" height="60"></div>